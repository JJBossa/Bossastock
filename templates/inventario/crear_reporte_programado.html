{% extends 'base.html' %}

{% block title %}Crear Reporte Programado - STOCKEX{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'inicio' %}"><i class="bi bi-house-door"></i> Inicio</a></li>
        <li class="breadcrumb-item"><a href="{% url 'listar_reportes_programados' %}">Reportes Programados</a></li>
        <li class="breadcrumb-item active">Crear</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-calendar-check text-primary"></i> Crear Reporte Programado</h2>
    <div class="d-flex gap-2">
        <a href="{% url 'inicio' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Volver al Inicio
        </a>
        <a href="{% url 'listar_reportes_programados' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Volver
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre del Reporte *</label>
                        <input type="text" name="nombre" id="nombre" class="form-control" required placeholder="Ej: Reporte Semanal de Ventas">
                    </div>
                    
                    <div class="mb-3">
                        <label for="tipo_reporte" class="form-label">Tipo de Reporte *</label>
                        <select name="tipo_reporte" id="tipo_reporte" class="form-select" required>
                            <option value="ventas">Reporte de Ventas</option>
                            <option value="inventario">Reporte de Inventario</option>
                            <option value="stock_bajo">Productos con Stock Bajo</option>
                            <option value="cuentas_cobrar">Cuentas por Cobrar</option>
                            <option value="completo">Reporte Completo</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="formato" class="form-label">Formato *</label>
                        <select name="formato" id="formato" class="form-select" required>
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="frecuencia" class="form-label">Frecuencia *</label>
                        <select name="frecuencia" id="frecuencia" class="form-select" required onchange="toggleFrecuenciaFields()">
                            <option value="diario">Diario</option>
                            <option value="semanal">Semanal</option>
                            <option value="mensual">Mensual</option>
                            <option value="personalizado">Personalizado</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="div-dia-semana" style="display: none;">
                        <label for="dia_semana" class="form-label">Día de la Semana *</label>
                        <select name="dia_semana" id="dia_semana" class="form-select">
                            <option value="0">Lunes</option>
                            <option value="1">Martes</option>
                            <option value="2">Miércoles</option>
                            <option value="3">Jueves</option>
                            <option value="4">Viernes</option>
                            <option value="5">Sábado</option>
                            <option value="6">Domingo</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="div-dia-mes" style="display: none;">
                        <label for="dia_mes" class="form-label">Día del Mes *</label>
                        <input type="number" name="dia_mes" id="dia_mes" class="form-control" min="1" max="31" placeholder="1-31">
                    </div>
                    
                    <div class="mb-3">
                        <label for="hora_envio" class="form-label">Hora de Envío *</label>
                        <input type="time" name="hora_envio" id="hora_envio" class="form-control" value="09:00" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="destinatarios" class="form-label">Destinatarios (Emails) *</label>
                        <textarea name="destinatarios" id="destinatarios" class="form-control" rows="3" required placeholder="email1@ejemplo.com, email2@ejemplo.com"></textarea>
                        <small class="text-muted">Separa múltiples emails con comas</small>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-check-circle"></i> Crear Reporte Programado
                        </button>
                        <a href="{% url 'listar_reportes_programados' %}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleFrecuenciaFields() {
    const frecuencia = document.getElementById('frecuencia').value;
    const divDiaSemana = document.getElementById('div-dia-semana');
    const divDiaMes = document.getElementById('div-dia-mes');
    
    if (frecuencia === 'semanal') {
        divDiaSemana.style.display = 'block';
        divDiaMes.style.display = 'none';
    } else if (frecuencia === 'mensual') {
        divDiaSemana.style.display = 'none';
        divDiaMes.style.display = 'block';
    } else {
        divDiaSemana.style.display = 'none';
        divDiaMes.style.display = 'none';
    }
}
</script>
{% endblock %}

