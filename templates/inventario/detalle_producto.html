{% extends 'base.html' %}

{% block title %}{{ producto.nombre }} - Detalle{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card">
            {% if producto.imagen %}
            <img src="{{ producto.imagen.url }}" class="card-img-top producto-imagen-detalle" alt="{{ producto.nombre }}">
            {% else %}
            <div class="card-img-top d-flex align-items-center justify-content-center producto-placeholder-detalle">
                <i class="bi bi-image producto-placeholder-icon-detalle"></i>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">{{ producto.nombre }}</h4>
                {% if es_admin %}
                <div>
                    <a href="{% url 'editar_producto' producto.id %}" class="btn btn-warning btn-sm">
                        <i class="bi bi-pencil-square"></i> Editar
                    </a>
                </div>
                {% endif %}
            </div>
            <div class="card-body">
                <table class="table">
                    <tr>
                        <th width="200">SKU/Código:</th>
                        <td>{{ producto.sku|default:"No asignado" }}</td>
                    </tr>
                    <tr>
                        <th>Categoría:</th>
                        <td>
                            {% if producto.categoria %}
                                <span class="badge badge-categoria" style="background-color: {{ producto.categoria.color }};">
                                    {{ producto.categoria.nombre }}
                                </span>
                            {% else %}
                            <span class="text-muted">Sin categoría</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Precio Unidad:</th>
                        <td><strong class="text-primary precio-destacado">${{ producto.precio|floatformat:0 }}</strong></td>
                    </tr>
                    {% if producto.precio_promo %}
                    <tr>
                        <th>Precio Promo:</th>
                        <td><strong class="text-success precio-destacado">${{ producto.precio_promo|floatformat:0 }}</strong></td>
                    </tr>
                    {% endif %}
                    <tr>
                        <th>Stock:</th>
                        <td>
                            {% if producto.stock > 10 %}
                            <span class="badge bg-success stock-badge">{{ producto.stock }} unidades</span>
                            {% elif producto.stock > 0 %}
                            <span class="badge bg-warning stock-badge">{{ producto.stock }} unidades</span>
                            {% else %}
                            <span class="badge bg-danger stock-badge">Sin stock</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Stock Mínimo:</th>
                        <td>{{ producto.stock_minimo }} unidades</td>
                    </tr>
                    <tr>
                        <th>Valor Inventario:</th>
                        <td><strong>${{ producto.valor_inventario|floatformat:0 }}</strong></td>
                    </tr>
                    <tr>
                        <th>Estado:</th>
                        <td>
                            {% if producto.activo %}
                            <span class="badge bg-success">Activo</span>
                            {% else %}
                            <span class="badge bg-secondary">Inactivo</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% if producto.descripcion %}
                    <tr>
                        <th>Descripción:</th>
                        <td>{{ producto.descripcion }}</td>
                    </tr>
                    {% endif %}
                    <tr>
                        <th>Fecha Creación:</th>
                        <td>{{ producto.fecha_creacion|date:"d/m/Y H:i" }}</td>
                    </tr>
                    <tr>
                        <th>Última Actualización:</th>
                        <td>{{ producto.fecha_actualizacion|date:"d/m/Y H:i" }}</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <!-- Historial de cambios -->
        {% if historial %}
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Historial de Cambios</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Usuario</th>
                                <th>Detalle</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cambio in historial %}
                            <tr>
                                <td>{{ cambio.fecha|date:"d/m/Y H:i" }}</td>
                                <td>
                                    {% if cambio.tipo_cambio == 'crear' %}
                                        <span class="badge bg-success">Creación</span>
                                    {% elif cambio.tipo_cambio == 'editar' %}
                                        <span class="badge bg-warning">Edición</span>
                                    {% elif cambio.tipo_cambio == 'eliminar' %}
                                        <span class="badge bg-danger">Eliminación</span>
                                    {% elif cambio.tipo_cambio == 'stock' %}
                                        <span class="badge bg-info">Stock</span>
                                    {% endif %}
                                </td>
                                <td>{{ cambio.usuario.username|default:"Sistema" }}</td>
                                <td>
                                    {% if cambio.campo_modificado %}
                                        <strong>{{ cambio.campo_modificado }}:</strong> 
                                        {{ cambio.valor_anterior }} → {{ cambio.valor_nuevo }}
                                    {% else %}
                                        {{ cambio.descripcion|default:"-" }}
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<div class="mt-3">
    <a href="{% url 'inicio' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Volver al Inicio
    </a>
</div>
{% endblock %}

